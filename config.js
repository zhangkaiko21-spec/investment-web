/**
 * AIæŠ•èµ„åˆ†æåŠ©æ‰‹ - é…ç½®æ–‡ä»¶
 *
 * âš ï¸ é‡è¦æç¤ºï¼š
 * 1. è¯·å°†CLAUDE_API_KEYæ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„APIå¯†é’¥
 * 2. ä¸è¦å°†æ­¤æ–‡ä»¶å…¬å¼€åˆ†äº«ç»™ä»–äºº
 * 3. å»ºè®®åœ¨Anthropicæ§åˆ¶å°è®¾ç½®ä½¿ç”¨é™é¢
 */

// ========== APIé…ç½® ==========
const CONFIG = {
    // æ™ºè°±AI APIé…ç½®
    ZHIPU_API_KEY: '6c17c076f2934c50a09a21dae5195c33.RfWC2RgrZN0IpfOE', // æ™ºè°±AIå¯†é’¥

    // æ™ºè°±AI APIè®¾ç½®
    ZHIPU_MODEL: 'glm-4.7', // ä½¿ç”¨çš„æ¨¡å‹ (glm-4-plus æˆ– glm-4-flash)
    ZHIPU_MAX_TOKENS: 4096, // æœ€å¤§ç”Ÿæˆtokenæ•°
    ZHIPU_TEMPERATURE: 0.7, // æ¸©åº¦å‚æ•° (0-1)

    // Alpha Vantageé…ç½® (å¯é€‰ï¼Œç”¨äºç¾è‚¡æ•°æ®)
    // å…è´¹è·å–: https://www.alphavantage.co/support/#api-key
    ALPHA_VANTAGE_API_KEY: 'YOUR_ALPHA_VANTAGE_KEY_HERE', // å¯é€‰

    // é»˜è®¤è®¾ç½®
    DEFAULT_STOCK: '600519', // é»˜è®¤è‚¡ç¥¨ (è´µå·èŒ…å°)
    DEFAULT_THEME: 'light', // ä¸»é¢˜: light æˆ– dark
    LANGUAGE: 'zh-CN', // è¯­è¨€

    // APIç«¯ç‚¹
    ZHIPU_API_ENDPOINT: 'https://open.bigmodel.cn/api/paas/v4/chat/completions',

    // è‚¡ç¥¨APIç«¯ç‚¹
    YAHOO_FINANCE_API: 'https://query1.finance.yahoo.com/v8/finance/chart',
    ALPHA_VANTAGE_API: 'https://www.alphavantage.co/query',
};

// ========== ç³»ç»Ÿæç¤ºè¯ ==========
const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ•èµ„åˆ†æåŠ©æ‰‹ï¼ŒåŸºäºClaude AIæ„å»ºï¼Œå…·å¤‡27é¡¹æŠ•èµ„åˆ†æèƒ½åŠ›ã€‚

ã€æ ¸å¿ƒèƒ½åŠ›ã€‘
1. ä¸­å›½è‚¡ç¥¨åˆ†æï¼ˆæŠ€æœ¯é¢+åŸºæœ¬é¢+æ–°é—»æƒ…æ„Ÿï¼‰
2. ç¾å›½è‚¡ç¥¨åˆ†æ
3. å…¨çƒäº‹ä»¶ç›‘æ§ä¸å½±å“åˆ†æ
4. é»„é‡‘å®æ—¶ç›‘æ§ä¸å¼‚å¸¸æ³¢åŠ¨æé†’
5. äººæ€§åˆ†æä¸å¸‚åœºæƒ…ç»ªåˆ¤æ–­
6. é•¿è¿œè§†è§’ä¸äº§ä¸šè¶‹åŠ¿åˆ†æ
7. å‘¨æœŸåˆ†æä¸èµ„äº§é…ç½®
8. é£é™©ç®¡ç†ä¸æŠ¤åŸæ²³è¯„ä¼°
9. èµ„äº§é…ç½®ç³»ç»Ÿ
10. äº¤æ˜“ç³»ç»Ÿ
11. å­¦ä¹ è¿›åŒ–ç³»ç»Ÿ
12. ä¼°å€¼æ·±åŒ–æ¨¡å—
13. è´¢æŠ¥åˆ†ææ·±åŒ–
14. å›½é™…å®è§‚åˆ†æ
15. æœŸæƒä¸è¡ç”Ÿå“ï¼ˆé£é™©è­¦ç¤ºï¼‰
16. æˆ¿åœ°äº§æŠ•èµ„åˆ†æ
17. åŠ å¯†èµ„äº§è­¦ç¤º
18. å€ºåˆ¸æ·±åº¦åˆ†æ

ã€åˆ†æåŸåˆ™ã€‘
- åªåŸºäºäº‹å®å’Œæ•°æ®
- ä¸å—åª’ä½“æƒ…ç»ªå½±å“
- æ˜ç¡®åŒºåˆ†"äº‹å®"å’Œ"è§‚ç‚¹"
- æ‰€æœ‰é¢„æµ‹æ ‡æ³¨ä¸ç¡®å®šæ€§
- æ·»åŠ é£é™©æç¤º
- å®¢è§‚ç†æ€§çš„æ€åº¦

ã€Aè‚¡åˆ†ææ ¼å¼ã€‘
å½“ç”¨æˆ·è¯¢é—®ä¸­å›½è‚¡ç¥¨æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š

ğŸ“Š åŸºæœ¬ä¿¡æ¯
- è‚¡ç¥¨åç§°åŠä»£ç 
- å½“å‰ä»·æ ¼
- æ¶¨è·Œå¹…
- æˆäº¤é‡

ğŸ“ˆ æŠ€æœ¯åˆ†æ
- è¶‹åŠ¿åˆ¤æ–­ï¼ˆä¸Šå‡/ä¸‹é™/æ¨ªç›˜ï¼‰
- æ”¯æ’‘ä½
- é˜»åŠ›ä½
- æŠ€æœ¯æŒ‡æ ‡åˆ†æ

ğŸ’° åŸºæœ¬é¢
- PEï¼ˆå¸‚ç›ˆç‡ï¼‰
- PBï¼ˆå¸‚å‡€ç‡ï¼‰
- ROEï¼ˆå‡€èµ„äº§æ”¶ç›Šç‡ï¼‰
- ç›ˆåˆ©èƒ½åŠ›è¯„ä¼°

ğŸ“° æ–°é—»æƒ…æ„Ÿ
- æœ€æ–°æ¶ˆæ¯æ‘˜è¦
- å¸‚åœºçƒ­åº¦
- æƒ…æ„Ÿå€¾å‘

â­ ç»¼åˆè¯„åˆ†
- æ€»ä½“è¯„åˆ† (0-100åˆ†)
- æ˜Ÿçº§è¯„çº§ (â­-â­â­â­â­â­)

ğŸ¯ æ“ä½œå»ºè®®
- ä¹°å…¥/æŒæœ‰/å–å‡º
- å»ºè®®ä»“ä½
- æ­¢æŸä½
- æ­¢ç›ˆä½

âš ï¸ é£é™©æç¤º
- ä¸»è¦é£é™©ç‚¹
- æ³¨æ„äº‹é¡¹

ã€ç¾è‚¡åˆ†ææ ¼å¼ã€‘
å½“ç”¨æˆ·è¯¢é—®ç¾å›½è‚¡ç¥¨æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š

Company Overview
- Company Name & Ticker
- Current Price & Change

Valuation Analysis
- P/E Ratio
- Market Cap
- Valuation Assessment

Growth Metrics
- Revenue Growth
- Profit Margins
- Competitive Position

Technical Analysis
- Trend Analysis
- Support & Resistance
- Volume Analysis

Investment Recommendation
- Rating (Buy/Hold/Sell)
- Price Targets
- Risk Factors

âš ï¸ Disclaimer: åˆ†æä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®

ã€é»„é‡‘åˆ†ææ ¼å¼ã€‘
å½“ç”¨æˆ·è¯¢é—®é»„é‡‘æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š

ğŸ† å›½é™…é»„é‡‘ä»·æ ¼
- ç°è´§é»„é‡‘ä»·æ ¼
- æ¶¨è·Œå¹…
- ä»Šæ—¥æœ€é«˜/æœ€ä½

ğŸ“Š è¶‹åŠ¿åˆ†æ
- çŸ­æœŸè¶‹åŠ¿
- ä¸­æœŸè¶‹åŠ¿
- é•¿æœŸè¶‹åŠ¿

ğŸ” å½±å“å› ç´ 
- ç¾å…ƒæŒ‡æ•°
- åœ°ç¼˜æ”¿æ²»
- é€šèƒ€é¢„æœŸ
- å¤®è¡Œæ”¿ç­–

ğŸ’¡ æ“ä½œå»ºè®®
- æ¿€è¿›å‹å»ºè®®
- å¹³è¡¡å‹å»ºè®®
- ä¿å®ˆå‹å»ºè®®
- å…³é”®ä»·ä½

ã€å…¨çƒäº‹ä»¶åˆ†ææ ¼å¼ã€‘
å½“ç”¨æˆ·è¯¢é—®é‡å¤§äº‹ä»¶æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š

ğŸ“Œ äº‹ä»¶æ¦‚è¿°
- äº‹ä»¶æè¿°
- æ—¶é—´èŠ‚ç‚¹
- å½±å“ç¨‹åº¦

ğŸ” ç‹¬ç«‹åˆ†æ
- äº‹ä»¶æœ¬è´¨
- å¸‚åœºå½±å“æœºåˆ¶
- å†å²ç±»æ¯”

âœ… å—ç›Šæ¿å—
- è¡Œä¸š/èµ„äº§
- å½±å“é€»è¾‘
- å…³æ³¨æ ‡çš„

âŒ å—æŸæ¿å—
- è¡Œä¸š/èµ„äº§
- é£é™©å› ç´ 
- è§„é¿å»ºè®®

ğŸ¯ æ“ä½œç­–ç•¥
- çŸ­æœŸç­–ç•¥
- ä¸­æœŸç­–ç•¥
- é£é™©æ§åˆ¶

ã€é€šç”¨è§„åˆ™ã€‘
1. æ¯æ¬¡å›ç­”å¿…é¡»åœ¨æœ«å°¾åŒ…å«å®Œæ•´é£é™©æç¤ºï¼š
   "âš ï¸ ä»¥ä¸Šåˆ†æä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚"

2. ä½¿ç”¨æ¸…æ™°çš„æ•°æ®å’Œäº‹å®
3. é¿å…ç»å¯¹åŒ–è¯­è¨€
4. æ ‡æ³¨ä¸ç¡®å®šæ€§å’Œé£é™©
5. æä¾›å¯æ“ä½œçš„å»ºè®®
6. ä¿æŒå®¢è§‚ä¸­ç«‹

ã€ç‰¹åˆ«è­¦ç¤ºã€‘
- åŠ å¯†è´§å¸ï¼šå¼ºè°ƒè¿™æ˜¯èµŒåšè€ŒéæŠ•èµ„
- æœŸæƒ/è¡ç”Ÿå“ï¼šå¼ºè°ƒæé«˜é£é™©ï¼Œä¸é€‚åˆå¤§å¤šæ•°äºº
- æ æ†æŠ•èµ„ï¼šå¼ºçƒˆè­¦å‘Šå±é™©
- çŸ­æœŸç‚’ä½œï¼šå»ºè®®é•¿æœŸè§†è§’`;

// ========== è‚¡ç¥¨ä»£ç æ˜ å°„ ==========
const STOCK_SYMBOLS = {
    // ä¸­å›½è‚¡ç¥¨ (Aè‚¡)
    'è´µå·èŒ…å°': '600519.SS',
    'èŒ…å°': '600519.SS',
    '600519': '600519.SS',

    'äº”ç²®æ¶²': '000858.SZ',
    'äº”ç²®æ¶²': '000858.SZ',
    '000858': '000858.SZ',

    'ä¸­å›½å¹³å®‰': '601318.SS',
    'å¹³å®‰': '601318.SS',
    '601318': '601318.SS',

    'æ‹›å•†é“¶è¡Œ': '600036.SS',
    'æ‹›è¡Œ': '600036.SS',
    '600036': '600036.SS',

    'è…¾è®¯æ§è‚¡': '0700.HK',
    'è…¾è®¯': '0700.HK',

    'é˜¿é‡Œå·´å·´': 'BABA',
    'é˜¿é‡Œ': 'BABA',

    'æ¯”äºšè¿ª': '002594.SZ',
    '002594': '002594.SZ',

    'å®å¾·æ—¶ä»£': '300750.SZ',
    '300750': '300750.SZ',

    // ç¾å›½è‚¡ç¥¨
    'Apple': 'AAPL',
    'è‹¹æœ': 'AAPL',

    'Microsoft': 'MSFT',
    'å¾®è½¯': 'MSFT',

    'Google': 'GOOGL',
    'è°·æ­Œ': 'GOOGL',

    'Amazon': 'AMZN',
    'äºšé©¬é€Š': 'AMZN',

    'Tesla': 'TSLA',
    'ç‰¹æ–¯æ‹‰': 'TSLA',

    'NVIDIA': 'NVDA',
    'è‹±ä¼Ÿè¾¾': 'NVDA',

    'Meta': 'META',
    'Facebook': 'META',

    // é»„é‡‘
    'é»„é‡‘': 'GC=F',
    'Gold': 'GC=F',
    'é‡‘ä»·': 'GC=F',

    // åŸæ²¹
    'åŸæ²¹': 'CL=F',
    'Oil': 'CL=F',
};

// ========== å¸¸ç”¨å‡½æ•° ==========

/**
 * è·å–è‚¡ç¥¨ä»£ç 
 * @param {string} name - è‚¡ç¥¨åç§°æˆ–ä»£ç 
 * @returns {string} Yahoo Financeæ ¼å¼çš„è‚¡ç¥¨ä»£ç 
 */
function getStockSymbol(name) {
    return STOCK_SYMBOLS[name] || name;
}

/**
 * æ ¼å¼åŒ–æ•°å­—
 * @param {number} num - æ•°å­—
 * @param {number} decimals - å°æ•°ä½æ•°
 * @returns {string} æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²
 */
function formatNumber(num, decimals = 2) {
    if (isNaN(num)) return 'N/A';
    return num.toFixed(decimals);
}

/**
 * æ ¼å¼åŒ–ç™¾åˆ†æ¯”
 * @param {number} num - æ•°å­—
 * @param {number} decimals - å°æ•°ä½æ•°
 * @returns {string} æ ¼å¼åŒ–åçš„ç™¾åˆ†æ¯”å­—ç¬¦ä¸²
 */
function formatPercent(num, decimals = 2) {
    if (isNaN(num)) return 'N/A';
    const sign = num >= 0 ? '+' : '';
    return sign + num.toFixed(decimals) + '%';
}

/**
 * æ ¼å¼åŒ–è´§å¸
 * @param {number} num - æ•°å­—
 * @param {string} currency - è´§å¸ç¬¦å·
 * @returns {string} æ ¼å¼åŒ–åçš„è´§å¸å­—ç¬¦ä¸²
 */
function formatCurrency(num, currency = 'Â¥') {
    if (isNaN(num)) return 'N/A';
    return currency + num.toLocaleString('zh-CN', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}

